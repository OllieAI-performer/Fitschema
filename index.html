<!doctype html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FitSchema - Heupoperatie trainingsschema</title>
    <style>
      :root {
        --bg-1: #f6efe7;
        --bg-2: #e4f2ee;
        --ink: #1f2a2c;
        --muted: #5d6a6d;
        --accent: #c26e3a;
        --accent-2: #2f7b6f;
        --card: #fffaf4;
        --line: rgba(31, 42, 44, 0.12);
        --good: #2f7b6f;
        --warn: #c26e3a;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        color: var(--ink);
        background:
          radial-gradient(circle at top left, rgba(194, 110, 58, 0.14), transparent 55%),
          radial-gradient(circle at 10% 70%, rgba(47, 123, 111, 0.2), transparent 40%),
          linear-gradient(120deg, var(--bg-1), var(--bg-2));
        min-height: 100vh;
      }

      header {
        padding: 40px 24px 12px;
        text-align: center;
        animation: fadeIn 0.8s ease-out both;
      }

      header h1 {
        font-family: "Palatino Linotype", "Book Antiqua", serif;
        font-size: clamp(1.8rem, 3vw, 2.6rem);
        margin: 0 0 8px;
        letter-spacing: 0.02em;
      }

      header p {
        margin: 0;
        color: var(--muted);
        font-size: 1rem;
      }

      .lang-switch {
        margin-top: 14px;
        display: flex;
        gap: 10px;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        font-size: 0.9rem;
        color: var(--muted);
      }

      .lang-switch select {
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: #ffffff;
      }

      .app {
        display: grid;
        gap: 20px;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        padding: 20px 24px 40px;
        align-items: start;
      }

      .card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 20px;
        padding: 20px;
        box-shadow: 0 10px 26px rgba(31, 42, 44, 0.08);
        animation: slideUp 0.7s ease-out both;
      }

      .card:nth-of-type(2) {
        animation-delay: 0.12s;
      }

      .card:nth-of-type(3) {
        animation-delay: 0.22s;
      }

      .card:nth-of-type(4) {
        animation-delay: 0.3s;
      }

      .card h2 {
        margin: 0 0 16px;
        font-size: 1.2rem;
      }

      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      label {
        display: flex;
        flex-direction: column;
        gap: 6px;
        font-size: 0.9rem;
        color: var(--muted);
      }

      input,
      select,
      textarea,
      button {
        font-family: inherit;
        font-size: 0.95rem;
      }

      input,
      select,
      textarea {
        padding: 10px 12px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: #ffffff;
      }

      textarea {
        min-height: 72px;
        resize: vertical;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 10px 16px;
        background: var(--accent);
        color: white;
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(194, 110, 58, 0.2);
      }

      button.ghost {
        background: transparent;
        border: 1px solid var(--line);
        color: var(--ink);
        padding: 8px 12px;
      }

      button.fill {
        background: var(--accent-2);
      }

      .form-actions {
        display: flex;
        gap: 12px;
        margin-top: 10px;
      }

      .exercise-list {
        display: grid;
        gap: 12px;
        margin-top: 18px;
      }

      .exercise-card {
        padding: 12px;
        border-radius: 16px;
        border: 1px dashed var(--line);
        background: #ffffff;
      }

      .exercise-card h3 {
        margin: 0 0 6px;
        font-size: 1rem;
      }

      .exercise-card p {
        margin: 4px 0;
        color: var(--muted);
        font-size: 0.88rem;
      }

      .exercise-card .row {
        justify-content: flex-end;
      }

      .date-row {
        display: flex;
        gap: 10px;
        align-items: center;
        margin-bottom: 12px;
      }

      .daily-list {
        display: grid;
        gap: 14px;
      }

      .daily-item {
        padding: 12px;
        border-radius: 16px;
        border: 1px solid var(--line);
        background: #ffffff;
        display: grid;
        gap: 10px;
      }

      .daily-item-header {
        display: flex;
        justify-content: space-between;
        gap: 12px;
        flex-wrap: wrap;
      }

      .daily-item-title {
        font-weight: 600;
      }

      .daily-item-meta {
        color: var(--muted);
        font-size: 0.85rem;
      }

      .daily-actions {
        display: flex;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .count-badge {
        padding: 6px 12px;
        border-radius: 999px;
        background: rgba(47, 123, 111, 0.12);
        font-weight: 600;
      }

      .progress {
        height: 8px;
        background: rgba(31, 42, 44, 0.08);
        border-radius: 999px;
        overflow: hidden;
      }

      .progress span {
        display: block;
        height: 100%;
        background: linear-gradient(120deg, var(--accent), var(--accent-2));
        width: 0%;
      }

      .summary-grid {
        display: grid;
        gap: 10px;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        margin: 12px 0;
      }

      .summary-card {
        padding: 10px;
        border-radius: 14px;
        border: 1px solid var(--line);
        background: #ffffff;
        text-align: center;
      }

      .summary-card strong {
        display: block;
        font-size: 1.1rem;
      }

      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
        flex-wrap: wrap;
      }

      .tabs button {
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: transparent;
        color: var(--ink);
      }

      .tabs button.active {
        background: var(--ink);
        color: white;
      }

      .calendar-grid {
        display: grid;
        gap: 8px;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }

      .calendar-cell {
        padding: 10px;
        border-radius: 12px;
        border: 1px solid var(--line);
        background: #ffffff;
      }

      .calendar-cell small {
        color: var(--muted);
        display: block;
      }

      .calendar-cell strong {
        font-size: 1rem;
      }

      .calendar-cell .bar {
        margin-top: 6px;
        height: 6px;
        background: rgba(31, 42, 44, 0.1);
        border-radius: 999px;
        overflow: hidden;
      }

      .calendar-cell .bar span {
        display: block;
        height: 100%;
        background: var(--accent-2);
        width: 0%;
      }

      .calendar-cell.complete {
        border-color: rgba(47, 123, 111, 0.5);
        background: rgba(47, 123, 111, 0.08);
      }

      .inline-note {
        color: var(--muted);
        font-size: 0.85rem;
        margin-top: 10px;
      }

      .timer-panel {
        display: none;
        margin-top: 12px;
        padding: 10px;
        border-radius: 14px;
        border: 1px solid var(--line);
        background: rgba(47, 123, 111, 0.08);
        font-weight: 600;
      }

      .data-actions {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .file-input {
        position: relative;
        overflow: hidden;
      }

      .file-input input {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
      }

      dialog {
        border: none;
        border-radius: 16px;
        padding: 16px;
        width: min(520px, 90vw);
      }

      dialog::backdrop {
        background: rgba(0, 0, 0, 0.4);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(12px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @media (max-width: 640px) {
        header {
          text-align: left;
        }

        .lang-switch {
          justify-content: flex-start;
        }

        .app {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <h1 data-i18n="header.title">FitSchema voor heupherstel</h1>
      <p data-i18n="header.subtitle">
        Maak je oefeningen, vink per dag af, en kijk terug per week of maand.
      </p>
      <div class="lang-switch">
        <span data-i18n="language.label">Taal</span>
        <select id="language-select">
          <option value="nl" data-i18n="language.nl">Nederlands</option>
          <option value="en" data-i18n="language.en">Engels</option>
          <option value="ru" data-i18n="language.ru">Russisch</option>
        </select>
      </div>
    </header>

    <div class="app">
      <section class="card">
        <h2 data-i18n="section.plan">Schema invoeren</h2>
        <form id="exercise-form">
          <div class="row">
            <label style="flex: 1">
              <span data-i18n="form.exerciseName">Naam oefening</span>
              <input
                id="exercise-name"
                type="text"
                required
                placeholder="Bijv. heupflexie"
                data-i18n-placeholder="placeholder.exerciseName"
              />
            </label>
          </div>
          <div class="row">
            <label style="flex: 1">
              <span data-i18n="form.exerciseType">Type</span>
              <select id="exercise-mode">
                <option value="hold" data-i18n="exerciseType.hold">
                  Aantal per keer + seconden vasthouden
                </option>
                <option value="simple" data-i18n="exerciseType.simple">
                  Alleen aantal per keer
                </option>
                <option value="duration" data-i18n="exerciseType.duration">
                  Duur per sessie (minuten)
                </option>
              </select>
            </label>
            <label id="reps-field" style="flex: 1">
              <span data-i18n="form.repsPerSet">Aantal per keer</span>
              <input id="exercise-reps" type="number" min="1" value="10" required />
            </label>
            <label id="hold-field" style="flex: 1">
              <span data-i18n="form.holdSeconds">Vasthouden (sec)</span>
              <input id="exercise-hold" type="number" min="1" value="5" />
            </label>
            <label id="duration-field" style="flex: 1">
              <span data-i18n="form.durationMinutes">Duur per sessie (min)</span>
              <input id="exercise-duration" type="number" min="1" value="10" />
            </label>
          </div>
          <div class="row">
            <label style="flex: 1">
              <span data-i18n="form.sessionsPerDay">Hoe vaak per dag</span>
              <input id="exercise-sessions" type="number" min="1" value="3" required />
            </label>
            <label style="flex: 1">
              <span data-i18n="form.notes">Notities</span>
              <input
                id="exercise-notes"
                type="text"
                placeholder="Optioneel"
                data-i18n-placeholder="placeholder.notes"
              />
            </label>
          </div>
          <div class="form-actions">
            <button type="submit" id="save-exercise">Toevoegen</button>
            <button type="button" class="ghost" id="reset-form" data-i18n="button.cancel">
              Annuleren
            </button>
          </div>
        </form>

        <div class="exercise-list" id="exercise-list"></div>
      </section>

      <section class="card">
        <h2 data-i18n="section.daily">Dagelijkse checklist</h2>
        <div class="date-row">
          <input id="selected-date" type="date" />
          <button type="button" class="ghost" id="today-btn" data-i18n="button.today">
            Vandaag
          </button>
        </div>
        <div class="summary-grid" id="daily-summary"></div>
        <div class="daily-list" id="daily-list"></div>
        <div class="timer-panel" id="timer-panel"></div>
        <div class="inline-note" data-i18n="daily.tip">
          Tip: klik op "Voltooi" om alle sessies voor die oefening af te vinken.
        </div>
        <div class="row" style="margin-top: 16px">
          <label style="flex: 1">
            <span data-i18n="form.painScore">Pijnscore (0-10)</span>
            <input id="pain-score" type="range" min="0" max="10" value="0" />
            <span id="pain-value">0</span>
          </label>
          <label style="flex: 1">
            <span data-i18n="form.mobilityScore">Beweeglijkheid (1-5)</span>
            <input id="mobility-score" type="range" min="1" max="5" value="3" />
            <span id="mobility-value">3</span>
          </label>
        </div>
        <div class="row">
          <label style="flex: 1">
            <span data-i18n="form.minutesSpent">Tijd besteed (minuten)</span>
            <input id="minutes-spent" type="number" min="0" value="0" />
          </label>
        </div>
        <label>
          <span data-i18n="form.dailyNotes">Dagnotities</span>
          <textarea
            id="daily-note"
            placeholder="Wat ging goed of moeilijk?"
            data-i18n-placeholder="placeholder.dailyNote"
          ></textarea>
        </label>
        <div class="form-actions">
          <button type="button" id="save-daily" data-i18n="button.saveDay">
            Opslaan dag
          </button>
        </div>
      </section>

      <section class="card">
        <h2 data-i18n="section.overview">Overzicht</h2>
        <div class="tabs">
          <button type="button" class="active" data-view="day" data-i18n="tab.day">
            Dag
          </button>
          <button type="button" data-view="week" data-i18n="tab.week">Week</button>
          <button type="button" data-view="month" data-i18n="tab.month">Maand</button>
        </div>
        <div id="overview"></div>
      </section>

      <section class="card">
        <h2 data-i18n="section.data">Data</h2>
        <div class="data-actions">
          <button type="button" id="export-btn" data-i18n="button.export">Export</button>
          <button type="button" class="ghost" id="clear-btn" data-i18n="button.clear">
            Wis alles
          </button>
          <button type="button" class="ghost file-input">
            <span data-i18n="button.import">Import</span>
            <input id="import-file" type="file" accept="application/json" />
          </button>
        </div>
        <p class="inline-note" data-i18n="data.note">
          Alles blijft lokaal in je browser. Export maakt een back-up bestand.
        </p>
      </section>
    </div>

    <dialog id="export-dialog">
      <h3 data-i18n="dialog.exportTitle">Export</h3>
      <p data-i18n="dialog.exportBody">Je data is klaar om te downloaden.</p>
      <div class="form-actions">
        <button type="button" id="download-export" data-i18n="button.download">
          Download
        </button>
        <button type="button" class="ghost" id="close-export" data-i18n="button.close">
          Sluiten
        </button>
      </div>
    </dialog>

    <script>
      const STORAGE_KEY = "fitschema.v1";

      const state = loadState();
      let editingId = null;
      let activeTimer = null;

      const el = {
        form: document.getElementById("exercise-form"),
        name: document.getElementById("exercise-name"),
        mode: document.getElementById("exercise-mode"),
        reps: document.getElementById("exercise-reps"),
        hold: document.getElementById("exercise-hold"),
        holdField: document.getElementById("hold-field"),
        duration: document.getElementById("exercise-duration"),
        durationField: document.getElementById("duration-field"),
        repsField: document.getElementById("reps-field"),
        sessions: document.getElementById("exercise-sessions"),
        notes: document.getElementById("exercise-notes"),
        saveBtn: document.getElementById("save-exercise"),
        resetBtn: document.getElementById("reset-form"),
        list: document.getElementById("exercise-list"),
        selectedDate: document.getElementById("selected-date"),
        todayBtn: document.getElementById("today-btn"),
        dailyList: document.getElementById("daily-list"),
        dailySummary: document.getElementById("daily-summary"),
        pain: document.getElementById("pain-score"),
        painValue: document.getElementById("pain-value"),
        mobility: document.getElementById("mobility-score"),
        mobilityValue: document.getElementById("mobility-value"),
        minutes: document.getElementById("minutes-spent"),
        note: document.getElementById("daily-note"),
        saveDaily: document.getElementById("save-daily"),
        timerPanel: document.getElementById("timer-panel"),
        tabs: document.querySelectorAll(".tabs button"),
        overview: document.getElementById("overview"),
        exportBtn: document.getElementById("export-btn"),
        exportDialog: document.getElementById("export-dialog"),
        downloadExport: document.getElementById("download-export"),
        closeExport: document.getElementById("close-export"),
        importFile: document.getElementById("import-file"),
        clearBtn: document.getElementById("clear-btn"),
        languageSelect: document.getElementById("language-select"),
      };

      const translations = {
        nl: {
          "app.title": "FitSchema - Heupoperatie trainingsschema",
          "header.title": "FitSchema voor heupherstel",
          "header.subtitle":
            "Maak je oefeningen, vink per dag af, en kijk terug per week of maand.",
          "language.label": "Taal",
          "language.nl": "Nederlands",
          "language.en": "Engels",
          "language.ru": "Russisch",
          "section.plan": "Schema invoeren",
          "section.daily": "Dagelijkse checklist",
          "section.overview": "Overzicht",
          "section.data": "Data",
          "form.exerciseName": "Naam oefening",
          "form.exerciseType": "Type",
          "form.repsPerSet": "Aantal per keer",
          "form.holdSeconds": "Vasthouden (sec)",
          "form.durationMinutes": "Duur per sessie (min)",
          "form.sessionsPerDay": "Hoe vaak per dag",
          "form.notes": "Notities",
          "form.painScore": "Pijnscore (0-10)",
          "form.mobilityScore": "Beweeglijkheid (1-5)",
          "form.minutesSpent": "Tijd besteed (minuten)",
          "form.dailyNotes": "Dagnotities",
          "placeholder.exerciseName": "Bijv. heupflexie",
          "placeholder.notes": "Optioneel",
          "placeholder.dailyNote": "Wat ging goed of moeilijk?",
          "exerciseType.hold": "Aantal per keer + seconden vasthouden",
          "exerciseType.simple": "Alleen aantal per keer",
          "exerciseType.duration": "Duur per sessie (minuten)",
          "button.add": "Toevoegen",
          "button.save": "Opslaan",
          "button.cancel": "Annuleren",
          "button.today": "Vandaag",
          "button.saveDay": "Opslaan dag",
          "button.complete": "Voltooi",
          "button.timer": "Timer",
          "button.export": "Export",
          "button.clear": "Wis alles",
          "button.import": "Import",
          "button.download": "Download",
          "button.close": "Sluiten",
          "button.edit": "Bewerk",
          "button.delete": "Verwijder",
          "tab.day": "Dag",
          "tab.week": "Week",
          "tab.month": "Maand",
          "daily.tip": 'Tip: klik op "Voltooi" om alle sessies voor die oefening af te vinken.',
          "daily.summary.complete": "Dag compleet",
          "daily.summary.sessions": "Sessies gedaan",
          "daily.summary.streak": "Dagen op rij",
          "daily.none": "Voeg eerst oefeningen toe om af te vinken.",
          "daily.extraSessions": "Extra sessies: {count}",
          "overview.none": "Voeg oefeningen toe om overzicht te zien.",
          "overview.todayComplete": "Compleet vandaag",
          "overview.weekAvg": "Gemiddeld week",
          "overview.monthAvg": "Gemiddeld maand",
          "overview.selectDate": "Selecteer een andere datum om terug te kijken.",
          "data.note": "Alles blijft lokaal in je browser. Export maakt een back-up bestand.",
          "dialog.exportTitle": "Export",
          "dialog.exportBody": "Je data is klaar om te downloaden.",
          "exercise.none": "Nog geen oefeningen toegevoegd.",
          "exercise.perDay": "{count}x per dag",
          "exercise.description.hold": "{reps}x, {hold}s vasthouden",
          "exercise.description.simple": "{reps}x per sessie",
          "exercise.description.duration": "{minutes} min per sessie",
          "timer.done": "klaar!",
          "confirm.clearAll": "Weet je zeker dat je alles wilt wissen?",
        },
        en: {
          "app.title": "FitSchema - Hip surgery training plan",
          "header.title": "FitSchema for hip recovery",
          "header.subtitle":
            "Create your exercises, tick them off per day, and review by week or month.",
          "language.label": "Language",
          "language.nl": "Dutch",
          "language.en": "English",
          "language.ru": "Russian",
          "section.plan": "Add plan",
          "section.daily": "Daily checklist",
          "section.overview": "Overview",
          "section.data": "Data",
          "form.exerciseName": "Exercise name",
          "form.exerciseType": "Type",
          "form.repsPerSet": "Reps per set",
          "form.holdSeconds": "Hold (sec)",
          "form.durationMinutes": "Session length (min)",
          "form.sessionsPerDay": "Times per day",
          "form.notes": "Notes",
          "form.painScore": "Pain score (0-10)",
          "form.mobilityScore": "Mobility (1-5)",
          "form.minutesSpent": "Time spent (minutes)",
          "form.dailyNotes": "Daily notes",
          "placeholder.exerciseName": "e.g. hip flexion",
          "placeholder.notes": "Optional",
          "placeholder.dailyNote": "What felt good or difficult?",
          "exerciseType.hold": "Reps + hold seconds",
          "exerciseType.simple": "Reps only",
          "exerciseType.duration": "Session length (minutes)",
          "button.add": "Add",
          "button.save": "Save",
          "button.cancel": "Cancel",
          "button.today": "Today",
          "button.saveDay": "Save day",
          "button.complete": "Complete",
          "button.timer": "Timer",
          "button.export": "Export",
          "button.clear": "Clear all",
          "button.import": "Import",
          "button.download": "Download",
          "button.close": "Close",
          "button.edit": "Edit",
          "button.delete": "Delete",
          "tab.day": "Day",
          "tab.week": "Week",
          "tab.month": "Month",
          "daily.tip": 'Tip: click "Complete" to mark all sessions for that exercise.',
          "daily.summary.complete": "Day complete",
          "daily.summary.sessions": "Sessions done",
          "daily.summary.streak": "Days in a row",
          "daily.none": "Add exercises first to check them off.",
          "daily.extraSessions": "Extra sessions: {count}",
          "overview.none": "Add exercises to see the overview.",
          "overview.todayComplete": "Complete today",
          "overview.weekAvg": "Weekly average",
          "overview.monthAvg": "Monthly average",
          "overview.selectDate": "Select another date to look back.",
          "data.note": "Everything stays local in your browser. Export creates a backup file.",
          "dialog.exportTitle": "Export",
          "dialog.exportBody": "Your data is ready to download.",
          "exercise.none": "No exercises added yet.",
          "exercise.perDay": "{count}x per day",
          "exercise.description.hold": "{reps}x, hold {hold}s",
          "exercise.description.simple": "{reps}x per session",
          "exercise.description.duration": "{minutes} min per session",
          "timer.done": "done!",
          "confirm.clearAll": "Are you sure you want to clear everything?",
        },
        ru: {
          "app.title": "FitSchema - Тренировочный план после операции на бедре",
          "header.title": "FitSchema для восстановления бедра",
          "header.subtitle":
            "Создайте упражнения, отмечайте их по дням и смотрите прогресс по неделям или месяцам.",
          "language.label": "Язык",
          "language.nl": "Нидерландский",
          "language.en": "Английский",
          "language.ru": "Русский",
          "section.plan": "Добавить план",
          "section.daily": "Ежедневный чек-лист",
          "section.overview": "Обзор",
          "section.data": "Данные",
          "form.exerciseName": "Название упражнения",
          "form.exerciseType": "Тип",
          "form.repsPerSet": "Повторов за подход",
          "form.holdSeconds": "Удержание (сек)",
          "form.durationMinutes": "Длительность занятия (мин)",
          "form.sessionsPerDay": "Сколько раз в день",
          "form.notes": "Заметки",
          "form.painScore": "Боль (0-10)",
          "form.mobilityScore": "Подвижность (1-5)",
          "form.minutesSpent": "Время (минуты)",
          "form.dailyNotes": "Заметки дня",
          "placeholder.exerciseName": "например, сгибание бедра",
          "placeholder.notes": "Необязательно",
          "placeholder.dailyNote": "Что было хорошо или сложно?",
          "exerciseType.hold": "Повторы + удержание (сек)",
          "exerciseType.simple": "Только повторы",
          "exerciseType.duration": "Длительность занятия (минуты)",
          "button.add": "Добавить",
          "button.save": "Сохранить",
          "button.cancel": "Отмена",
          "button.today": "Сегодня",
          "button.saveDay": "Сохранить день",
          "button.complete": "Завершить",
          "button.timer": "Таймер",
          "button.export": "Экспорт",
          "button.clear": "Очистить все",
          "button.import": "Импорт",
          "button.download": "Скачать",
          "button.close": "Закрыть",
          "button.edit": "Редактировать",
          "button.delete": "Удалить",
          "tab.day": "День",
          "tab.week": "Неделя",
          "tab.month": "Месяц",
          "daily.tip": 'Совет: нажмите "Завершить", чтобы отметить все подходы по упражнению.',
          "daily.summary.complete": "День выполнен",
          "daily.summary.sessions": "Сделано подходов",
          "daily.summary.streak": "Дней подряд",
          "daily.none": "Сначала добавьте упражнения, чтобы отмечать их.",
          "daily.extraSessions": "Доп. подходы: {count}",
          "overview.none": "Добавьте упражнения, чтобы видеть обзор.",
          "overview.todayComplete": "Выполнено сегодня",
          "overview.weekAvg": "Среднее за неделю",
          "overview.monthAvg": "Среднее за месяц",
          "overview.selectDate": "Выберите другую дату, чтобы посмотреть назад.",
          "data.note": "Все данные остаются в вашем браузере. Экспорт создает резервную копию.",
          "dialog.exportTitle": "Экспорт",
          "dialog.exportBody": "Ваши данные готовы к скачиванию.",
          "exercise.none": "Пока нет добавленных упражнений.",
          "exercise.perDay": "{count}x в день",
          "exercise.description.hold": "{reps}x, удержание {hold} сек",
          "exercise.description.simple": "{reps}x за подход",
          "exercise.description.duration": "{minutes} мин за занятие",
          "timer.done": "готово!",
          "confirm.clearAll": "Вы уверены, что хотите все очистить?",
        },
      };

      init();

      function init() {
        state.language = state.language || "nl";
        el.languageSelect.value = state.language;
        el.selectedDate.value = state.selectedDate;
        bindEvents();
        applyLanguage();
        renderAll();
      }

      function bindEvents() {
        el.mode.addEventListener("change", toggleHoldField);
        el.form.addEventListener("submit", handleSaveExercise);
        el.resetBtn.addEventListener("click", resetForm);
        el.list.addEventListener("click", handleExerciseListClick);
        el.selectedDate.addEventListener("change", () => {
          state.selectedDate = el.selectedDate.value;
          saveState();
          renderAll();
        });
        el.todayBtn.addEventListener("click", () => {
          state.selectedDate = todayISO();
          el.selectedDate.value = state.selectedDate;
          saveState();
          renderAll();
        });
        el.dailyList.addEventListener("click", handleDailyAction);
        el.pain.addEventListener("input", () => {
          el.painValue.textContent = el.pain.value;
        });
        el.mobility.addEventListener("input", () => {
          el.mobilityValue.textContent = el.mobility.value;
        });
        el.saveDaily.addEventListener("click", saveDailyNote);
        el.tabs.forEach((tab) =>
          tab.addEventListener("click", () => {
            state.view = tab.dataset.view;
            saveState();
            renderOverview();
          })
        );
        el.exportBtn.addEventListener("click", () => {
          el.exportDialog.showModal();
        });
        el.closeExport.addEventListener("click", () => {
          el.exportDialog.close();
        });
        el.downloadExport.addEventListener("click", downloadExport);
        el.importFile.addEventListener("change", importData);
        el.clearBtn.addEventListener("click", clearAll);
        el.languageSelect.addEventListener("change", () => {
          state.language = el.languageSelect.value;
          saveState();
          applyLanguage();
          renderAll();
        });
      }

      function loadState() {
        const fallback = {
          exercises: [],
          logs: {},
          selectedDate: todayISO(),
          view: "day",
          language: "nl",
        };
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return fallback;
          const parsed = JSON.parse(raw);
          return { ...fallback, ...parsed };
        } catch (err) {
          return fallback;
        }
      }

      function saveState() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      }

      function todayISO() {
        const now = new Date();
        return now.toISOString().slice(0, 10);
      }

      function toggleHoldField() {
        if (el.mode.value === "hold") {
          el.holdField.style.display = "flex";
          el.durationField.style.display = "none";
          el.repsField.style.display = "flex";
          el.reps.required = true;
          el.duration.required = false;
          return;
        }
        if (el.mode.value === "duration") {
          el.holdField.style.display = "none";
          el.durationField.style.display = "flex";
          el.repsField.style.display = "none";
          el.reps.required = false;
          el.duration.required = true;
          return;
        } else {
          el.holdField.style.display = "none";
          el.durationField.style.display = "none";
          el.repsField.style.display = "flex";
          el.reps.required = true;
          el.duration.required = false;
        }
      }

      function resetForm() {
        editingId = null;
        el.form.reset();
        el.reps.value = 10;
        el.hold.value = 5;
        el.duration.value = 10;
        el.sessions.value = 3;
        updateSaveButtonLabel();
        toggleHoldField();
      }

      function handleSaveExercise(event) {
        event.preventDefault();
        const exercise = {
          id: editingId || Date.now().toString(36),
          name: el.name.value.trim(),
          mode: el.mode.value,
          reps: el.mode.value === "duration" ? 0 : Number(el.reps.value),
          holdSeconds: el.mode.value === "hold" ? Number(el.hold.value) : 0,
          durationMinutes: el.mode.value === "duration" ? Number(el.duration.value) : 0,
          sessionsPerDay: Number(el.sessions.value),
          notes: el.notes.value.trim(),
        };

        if (!exercise.name) return;

        if (editingId) {
          state.exercises = state.exercises.map((item) =>
            item.id === editingId ? exercise : item
          );
        } else {
          state.exercises.push(exercise);
        }

        saveState();
        resetForm();
        renderAll();
      }

      function handleExerciseListClick(event) {
        const button = event.target.closest("button");
        if (!button) return;
        const id = button.dataset.id;
        if (button.dataset.action === "edit") {
          const exercise = state.exercises.find((item) => item.id === id);
          if (!exercise) return;
          editingId = exercise.id;
          el.name.value = exercise.name;
          el.mode.value = exercise.mode;
          el.reps.value = exercise.reps;
          el.hold.value = exercise.holdSeconds || 5;
          el.duration.value = exercise.durationMinutes || 10;
          el.sessions.value = exercise.sessionsPerDay;
          el.notes.value = exercise.notes || "";
          updateSaveButtonLabel();
          toggleHoldField();
          return;
        }
        if (button.dataset.action === "delete") {
          state.exercises = state.exercises.filter((item) => item.id !== id);
          Object.values(state.logs).forEach((log) => {
            if (log.exercises) delete log.exercises[id];
          });
          saveState();
          renderAll();
        }
      }

      function getLog(date) {
        if (!state.logs[date]) {
          state.logs[date] = {
            exercises: {},
            pain: 0,
            mobility: 3,
            minutes: 0,
            note: "",
          };
        }
        return state.logs[date];
      }

      function handleDailyAction(event) {
        const button = event.target.closest("button");
        if (!button) return;
        const action = button.dataset.action;
        const id = button.dataset.id;
        const exercise = state.exercises.find((item) => item.id === id);
        if (!exercise) return;
        const log = getLog(state.selectedDate);
        const entry = log.exercises[id] || { completed: 0 };
        const target = exercise.sessionsPerDay;
        if (action === "inc") {
          entry.completed = Math.min(target, entry.completed + 1);
        }
        if (action === "dec") {
          entry.completed = Math.max(0, entry.completed - 1);
        }
        if (action === "done") {
          entry.completed = target;
        }
        if (action === "timer") {
          const seconds =
            exercise.mode === "duration"
              ? exercise.durationMinutes * 60
              : exercise.holdSeconds;
          startTimer(seconds, exercise.name);
          return;
        }
        log.exercises[id] = entry;
        saveState();
        renderAll();
      }

      function saveDailyNote() {
        const log = getLog(state.selectedDate);
        log.pain = Number(el.pain.value);
        log.mobility = Number(el.mobility.value);
        log.minutes = Number(el.minutes.value);
        log.note = el.note.value.trim();
        saveState();
        renderAll();
      }

      function renderAll() {
        renderExerciseList();
        renderDaily();
        renderOverview();
      }

      function renderExerciseList() {
        if (!state.exercises.length) {
          el.list.innerHTML = `<p class='inline-note'>${t("exercise.none")}</p>`;
          return;
        }
        el.list.innerHTML = state.exercises
          .map((exercise) => {
            const description = getExerciseDescription(exercise);
            const perDay = t("exercise.perDay", { count: exercise.sessionsPerDay });
            const notes = exercise.notes ? `<p>${exercise.notes}</p>` : "";
            return `
              <div class="exercise-card">
                <h3>${escapeHtml(exercise.name)}</h3>
                <p>${description} - ${perDay}</p>
                ${notes}
                <div class="row">
                  <button type="button" class="ghost" data-action="edit" data-id="${exercise.id}">
                    ${t("button.edit")}
                  </button>
                  <button type="button" class="ghost" data-action="delete" data-id="${exercise.id}">
                    ${t("button.delete")}
                  </button>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function renderDaily() {
        const log = getLog(state.selectedDate);
        el.pain.value = log.pain || 0;
        el.painValue.textContent = log.pain || 0;
        el.mobility.value = log.mobility || 3;
        el.mobilityValue.textContent = log.mobility || 3;
        el.minutes.value = log.minutes || 0;
        el.note.value = log.note || "";

        const totals = calculateTotals(state.selectedDate);
        el.dailySummary.innerHTML = `
          <div class="summary-card">
            <strong>${totals.percent}%</strong>
            ${t("daily.summary.complete")}
          </div>
          <div class="summary-card">
            <strong>${totals.completed}/${totals.target}</strong>
            ${t("daily.summary.sessions")}
          </div>
          <div class="summary-card">
            <strong>${totals.streak}</strong>
            ${t("daily.summary.streak")}
          </div>
        `;

        if (!state.exercises.length) {
          el.dailyList.innerHTML =
            `<p class='inline-note'>${t("daily.none")}</p>`;
          return;
        }

        el.dailyList.innerHTML = state.exercises
          .map((exercise) => {
            const entry = log.exercises[exercise.id] || { completed: 0 };
            const target = exercise.sessionsPerDay;
            const cappedCompleted = Math.min(entry.completed, target);
            const percent = Math.round((cappedCompleted / target) * 100) || 0;
            const extraNote =
              entry.completed > target
                ? `<div class="daily-item-meta">${t("daily.extraSessions", {
                    count: entry.completed - target,
                  })}</div>`
                : "";
            const description = getExerciseDescription(exercise);
            const perDay = t("exercise.perDay", { count: target });
            return `
              <div class="daily-item">
                <div class="daily-item-header">
                  <div>
                    <div class="daily-item-title">${escapeHtml(exercise.name)}</div>
                    <div class="daily-item-meta">${description} - ${perDay}</div>
                    ${extraNote}
                  </div>
                  <div class="count-badge">${cappedCompleted}/${target}</div>
                </div>
                <div class="daily-actions">
                  <button type="button" class="ghost" data-action="dec" data-id="${exercise.id}">-</button>
                  <button type="button" class="ghost" data-action="inc" data-id="${exercise.id}">+</button>
                  <button type="button" class="fill" data-action="done" data-id="${exercise.id}">
                    ${t("button.complete")}
                  </button>
                  ${
                    exercise.mode === "hold" || exercise.mode === "duration"
                      ? `<button type="button" class="ghost" data-action="timer" data-id="${exercise.id}">
                          ${t("button.timer")}
                        </button>`
                      : ""
                  }
                </div>
                <div class="progress">
                  <span style="width:${percent}%"></span>
                </div>
              </div>
            `;
          })
          .join("");
      }

      function renderOverview() {
        el.tabs.forEach((tab) => {
          tab.classList.toggle("active", tab.dataset.view === state.view);
        });

        if (!state.exercises.length) {
          el.overview.innerHTML =
            `<p class='inline-note'>${t("overview.none")}</p>`;
          return;
        }

        if (state.view === "day") {
          const totals = calculateTotals(state.selectedDate);
          el.overview.innerHTML = `
            <div class="summary-grid">
              <div class="summary-card">
                <strong>${totals.percent}%</strong>
                ${t("overview.todayComplete")}
              </div>
              <div class="summary-card">
                <strong>${totals.week}%</strong>
                ${t("overview.weekAvg")}
              </div>
              <div class="summary-card">
                <strong>${totals.month}%</strong>
                ${t("overview.monthAvg")}
              </div>
            </div>
            <p class="inline-note">${t("overview.selectDate")}</p>
          `;
          return;
        }

        if (state.view === "week") {
          const start = startOfWeek(parseISO(state.selectedDate));
          const days = Array.from({ length: 7 }).map((_, index) =>
            addDays(start, index)
          );
          el.overview.innerHTML = `
            <div class="calendar-grid">
              ${days.map(renderCalendarCell).join("")}
            </div>
          `;
          return;
        }

        if (state.view === "month") {
          const date = parseISO(state.selectedDate);
          const days = monthDays(date);
          el.overview.innerHTML = `
            <div class="calendar-grid">
              ${days.map(renderCalendarCell).join("")}
            </div>
          `;
        }
      }

      function renderCalendarCell(date) {
        const iso = toISO(date);
        const totals = calculateTotals(iso);
        const className = totals.percent === 100 ? "calendar-cell complete" : "calendar-cell";
        return `
          <div class="${className}">
            <small>${formatDateShort(date)}</small>
            <strong>${totals.percent}%</strong>
            <div class="bar"><span style="width:${totals.percent}%"></span></div>
          </div>
        `;
      }

      function calculateTotals(dateISO) {
        const log = getLog(dateISO);
        let target = 0;
        let completed = 0;
        state.exercises.forEach((exercise) => {
          const entry = log.exercises[exercise.id] || { completed: 0 };
          target += exercise.sessionsPerDay;
          completed += Math.min(entry.completed, exercise.sessionsPerDay);
        });
        const percent = target ? Math.round((completed / target) * 100) : 0;
        const week = averageForRange(dateISO, 7);
        const month = averageForRange(dateISO, 30);
        const streak = calculateStreak(dateISO);
        return { target, completed, percent, week, month, streak };
      }

      function averageForRange(dateISO, days) {
        const date = parseISO(dateISO);
        let total = 0;
        for (let i = 0; i < days; i += 1) {
          const day = addDays(date, -i);
          total += calculateDayPercent(toISO(day));
        }
        return Math.round(total / days);
      }

      function calculateDayPercent(dateISO) {
        const log = getLog(dateISO);
        let target = 0;
        let completed = 0;
        state.exercises.forEach((exercise) => {
          const entry = log.exercises[exercise.id] || { completed: 0 };
          target += exercise.sessionsPerDay;
          completed += Math.min(entry.completed, exercise.sessionsPerDay);
        });
        return target ? Math.round((completed / target) * 100) : 0;
      }

      function calculateStreak(dateISO) {
        let streak = 0;
        let date = parseISO(dateISO);
        while (true) {
          const percent = calculateDayPercent(toISO(date));
          if (percent < 100 || percent === 0) break;
          streak += 1;
          date = addDays(date, -1);
        }
        return streak;
      }

      function startTimer(seconds, name) {
        if (!seconds) return;
        if (activeTimer) clearInterval(activeTimer);
        let remaining = seconds;
        el.timerPanel.style.display = "block";
        el.timerPanel.textContent = `${name}: ${formatTimer(remaining)}`;
        activeTimer = setInterval(() => {
          remaining -= 1;
          if (remaining <= 0) {
            clearInterval(activeTimer);
            activeTimer = null;
            el.timerPanel.textContent = `${name}: ${t("timer.done")}`;
            return;
          }
          el.timerPanel.textContent = `${name}: ${formatTimer(remaining)}`;
        }, 1000);
      }

      function downloadExport() {
        const data = JSON.stringify(state, null, 2);
        const blob = new Blob([data], { type: "application/json" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `fitschema-${todayISO()}.json`;
        link.click();
        URL.revokeObjectURL(link.href);
        el.exportDialog.close();
      }

      function importData(event) {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const parsed = JSON.parse(reader.result);
            if (!parsed.exercises || !parsed.logs) {
              return;
            }
            state.exercises = parsed.exercises;
            state.logs = parsed.logs;
            state.selectedDate = parsed.selectedDate || todayISO();
            state.view = parsed.view || "day";
            state.language = parsed.language || state.language || "nl";
            el.languageSelect.value = state.language;
            saveState();
            applyLanguage();
            renderAll();
          } catch (err) {
            return;
          }
        };
        reader.readAsText(file);
        event.target.value = "";
      }

      function clearAll() {
        if (!confirm(t("confirm.clearAll"))) return;
        state.exercises = [];
        state.logs = {};
        state.selectedDate = todayISO();
        state.view = "day";
        saveState();
        renderAll();
      }

      function escapeHtml(value) {
        return value
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#39;");
      }

      function parseISO(value) {
        const [year, month, day] = value.split("-").map(Number);
        return new Date(year, month - 1, day);
      }

      function toISO(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      function addDays(date, amount) {
        const copy = new Date(date);
        copy.setDate(copy.getDate() + amount);
        return copy;
      }

      function startOfWeek(date) {
        const copy = new Date(date);
        const day = copy.getDay();
        const diff = (day === 0 ? -6 : 1) - day;
        copy.setDate(copy.getDate() + diff);
        return copy;
      }

      function monthDays(date) {
        const year = date.getFullYear();
        const month = date.getMonth();
        const lastDay = new Date(year, month + 1, 0).getDate();
        return Array.from({ length: lastDay }).map((_, index) => {
          return new Date(year, month, index + 1);
        });
      }

      function formatDateShort(date) {
        const day = String(date.getDate()).padStart(2, "0");
        const month = String(date.getMonth() + 1).padStart(2, "0");
        return `${day}-${month}`;
      }

      function formatTimer(totalSeconds) {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        return `${minutes}:${seconds}`;
      }

      function applyLanguage() {
        document.documentElement.lang = state.language;
        document.title = t("app.title");
        document.querySelectorAll("[data-i18n]").forEach((node) => {
          const key = node.dataset.i18n;
          node.textContent = t(key);
        });
        document.querySelectorAll("[data-i18n-placeholder]").forEach((node) => {
          const key = node.dataset.i18nPlaceholder;
          node.setAttribute("placeholder", t(key));
        });
        updateSaveButtonLabel();
      }

      function updateSaveButtonLabel() {
        el.saveBtn.textContent = editingId ? t("button.save") : t("button.add");
      }

      function t(key, vars = {}) {
        const catalog = translations[state.language] || translations.nl;
        const template = catalog[key] || translations.nl[key] || key;
        return template.replace(/\{(\w+)\}/g, (_, name) =>
          Object.prototype.hasOwnProperty.call(vars, name) ? vars[name] : `{${name}}`
        );
      }

      function getExerciseDescription(exercise) {
        if (exercise.mode === "hold") {
          return t("exercise.description.hold", {
            reps: exercise.reps,
            hold: exercise.holdSeconds,
          });
        }
        if (exercise.mode === "duration") {
          return t("exercise.description.duration", {
            minutes: exercise.durationMinutes,
          });
        }
        return t("exercise.description.simple", { reps: exercise.reps });
      }

      toggleHoldField();
    </script>
  </body>
</html>
